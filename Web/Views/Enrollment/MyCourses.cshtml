@model List<BusinessLogic.DTOs.Responses.MyEnrolledCourseResponse>

@{
    ViewData["Title"] = "Kh√≥a h·ªçc c·ªßa t√¥i";
}

<div class="container py-4">

    <!-- Hero Gradient -->
    <div class="hero-mycourses rounded-4 p-4 p-md-5 mb-4 text-white position-relative overflow-hidden">
        <div class="position-absolute top-0 start-0 w-100 h-100 opacity-10">
            <i class="fas fa-user-graduate position-absolute" style="font-size: 15rem; top: -3rem; right: -3rem;"></i>
        </div>
        <div class="position-relative">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">
                <div>
                    <h1 class="fw-bold mb-2 display-6">
                        <i class="fas fa-graduation-cap me-2"></i>@ViewData["Title"]
                    </h1>
                    <p class="fs-5 mb-3 text-white-50">Theo d√µi ti·∫øn tr√¨nh h·ªçc t·∫≠p v√† qu·∫£n l√Ω c√°c m√¥n ƒë√£ ƒëƒÉng k√Ω.</p>
                    <div class="d-flex gap-2 flex-wrap">
                        <a asp-action="Index" class="btn btn-light btn-lg rounded-pill px-4">
                            <i class="fas fa-plus-circle me-2"></i>ƒêƒÉng k√Ω th√™m m√¥n
                        </a>
                        <a href="#courseTable" class="btn btn-outline-light btn-lg rounded-pill px-4">
                            <i class="fas fa-list me-2"></i>Xem danh s√°ch
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alerts -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show rounded-4 border-0 shadow-sm" role="alert">
            <i class="fas fa-check-circle me-2"></i><strong>Th√†nh c√¥ng!</strong> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show rounded-4 border-0 shadow-sm" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i><strong>L·ªói!</strong> @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Tabs -->
    <ul class="nav nav-pills mb-4 gap-2 p-3 bg-light rounded-4">
        <li class="nav-item">
            <a class="nav-link rounded-pill px-4" asp-action="Index">
                <i class="fas fa-list me-2"></i>Kh√≥a h·ªçc c√≥ s·∫µn
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link active rounded-pill px-4 shadow-sm" asp-action="MyCourses">
                <i class="fas fa-graduation-cap me-2"></i>Kh√≥a h·ªçc c·ªßa t√¥i
            </a>
        </li>
    </ul>

    <!-- Summary Cards -->
    @if (Model != null && Model.Any())
    {
        <div class="row g-4 mb-4">
            <div class="col-md-4">
                <div class="stat-card card border-0 rounded-4 shadow-sm h-100 card-primary">
                    <div class="card-body p-4 text-center">
                        <div class="icon-circle mx-auto mb-3">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <h2 class="display-4 fw-bold mb-2">@Model.Count</h2>
                        <p class="text-muted mb-0 fw-semibold">Kh√≥a h·ªçc ƒë√£ ƒëƒÉng k√Ω</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card card border-0 rounded-4 shadow-sm h-100 card-success">
                    <div class="card-body p-4 text-center">
                        <div class="icon-circle mx-auto mb-3">
                            <i class="fas fa-play-circle"></i>
                        </div>
                        <h2 class="display-4 fw-bold mb-2">@Model.Where(m => m.Status == "Active").Count()</h2>
                        <p class="text-muted mb-0 fw-semibold">ƒêang h·ªçc</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card card border-0 rounded-4 shadow-sm h-100 card-info">
                    <div class="card-body p-4 text-center">
                        <div class="icon-circle mx-auto mb-3">
                            <i class="fas fa-star"></i>
                        </div>
                        <h2 class="display-4 fw-bold mb-2">@Model.Sum(m => m.Credits ?? 0)</h2>
                        <p class="text-muted mb-0 fw-semibold">T·ªïng t√≠n ch·ªâ</p>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Course Table -->
    <div id="courseTable" class="card border-0 shadow-sm rounded-4">
        <div class="card-header bg-gradient border-0 p-4">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0 fw-bold">
                    <i class="fas fa-table me-2 text-primary"></i>Danh s√°ch kh√≥a h·ªçc ƒë√£ ƒëƒÉng k√Ω
                </h5>
                @if (Model != null && Model.Any())
                {
                    <span class="badge bg-primary rounded-pill px-3 py-2">
                        @Model.Count m√¥n h·ªçc
                    </span>
                }
            </div>
        </div>
        <div class="card-body p-0">
            @if (Model != null && Model.Any())
            {
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0 modern-table">
                        <thead class="table-light">
                            <tr>
                                <th class="text-center" style="width: 60px;">#</th>
                                <th style="width: 130px;">M√£ m√¥n</th>
                                <th>T√™n kh√≥a h·ªçc</th>
                                <th>Gi·∫£ng vi√™n</th>
                                <th class="text-center" style="width: 100px;">T√≠n ch·ªâ</th>
                                <th class="text-center" style="width: 130px;">H·ªçc k·ª≥</th>
                                <th class="text-center" style="width: 130px;">Ng√†y ƒëƒÉng k√Ω</th>
                                <th class="text-center" style="width: 130px;">Tr·∫°ng th√°i</th>
                                <th class="text-center" style="width: 150px;">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                var index = 1;
                            }
                            @foreach (var course in Model)
                            {
                                <tr class="course-row">
                                    <td class="text-center text-muted fw-semibold">@(index++)</td>
                                    <td>
                                        <span class="badge bg-primary bg-gradient rounded-pill px-3 py-2">
                                            @course.CourseCode
                                        </span>
                                    </td>
                                    <td>
                                        <div class="fw-semibold text-dark">@course.CourseName</div>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-user-tie text-muted me-2"></i>
                                            <span>@(course.TeacherName ?? "Ch∆∞a ph√¢n c√¥ng")</span>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-warning text-dark rounded-pill px-3 py-2">
                                            <i class="fas fa-star me-1"></i>@(course.Credits?.ToString() ?? "N/A")
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <span class="text-muted">@(course.Semester ?? "N/A")</span>
                                    </td>
                                    <td class="text-center">
                                        <small class="text-muted">
                                            <i class="fas fa-calendar-alt me-1"></i>
                                            @(course.EnrollDate?.ToString("dd/MM/yyyy") ?? "N/A")
                                        </small>
                                    </td>
                                    <td class="text-center">
                                        @{
                                            var badgeClass = course.Status switch
                                            {
                                                                "Active" => "bg-success",
                                                                "Completed" => "bg-primary",
                                                                "Dropped" => "bg-danger",
                                                _ => "bg-secondary"
                                            };
                                            var statusText = course.Status switch
                                            {
                                                                "Active" => "ƒêang h·ªçc",
                                                                "Completed" => "Ho√†n th√†nh",
                                                                "Dropped" => "ƒê√£ h·ªßy",
                                                _ => course.Status
                                            };
                                            var statusIcon = course.Status switch
                                            {
                                                                "Active" => "fa-play-circle",
                                                                "Completed" => "fa-check-circle",
                                                                "Dropped" => "fa-times-circle",
                                                _ => "fa-question-circle"
                                            };
                                        }
                                        <span class="badge @badgeClass rounded-pill px-3 py-2">
                                            <i class="fas @statusIcon me-1"></i>@statusText
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        @if (course.Status == "Active")
                                        {
                                            <form asp-action="Unenroll" method="post" class="d-inline"
                                                  onsubmit="return confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒëƒÉng k√Ω kh√≥a h·ªçc n√†y?\n\nüìù L∆∞u √Ω: D·ªØ li·ªáu ƒëi·ªÉm s·ªë v√† l·ªãch s·ª≠ s·∫Ω ƒë∆∞·ª£c gi·ªØ l·∫°i.');">
                                                <input type="hidden" name="courseId" value="@course.CourseId" />
                                                <button type="submit" class="btn btn-sm btn-danger rounded-pill px-3" title="H·ªßy ƒëƒÉng k√Ω">
                                                    <i class="fas fa-times-circle me-1"></i>H·ªßy
                                                </button>
                                            </form>
                                        }
                                        else if (course.Status == "Dropped")
                                        {
                                            <span class="text-muted small">
                                                <i class="fas fa-ban me-1"></i>ƒê√£ h·ªßy
                                            </span>
                                        }
                                        else if (course.Status == "Completed")
                                        {
                                            <span class="text-success small">
                                                <i class="fas fa-check-double me-1"></i>Ho√†n th√†nh
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center py-5 px-4">
                    <div class="mb-4">
                        <i class="fas fa-inbox text-muted" style="font-size: 5rem; opacity: 0.3;"></i>
                    </div>
                    <h5 class="text-muted mb-2">Ch∆∞a c√≥ kh√≥a h·ªçc n√†o</h5>
                    <p class="text-muted mb-4">B·∫°n ch∆∞a ƒëƒÉng k√Ω m√¥n h·ªçc n√†o. H√£y kh√°m ph√° v√† ƒëƒÉng k√Ω ngay!</p>
                    <a asp-action="Index" class="btn btn-primary btn-lg rounded-pill px-4 shadow-sm">
                        <i class="fas fa-plus-circle me-2"></i>ƒêƒÉng k√Ω kh√≥a h·ªçc ngay
                    </a>
                </div>
            }
        </div>
    </div>

    <!-- Quick Actions (n·∫øu c√≥ courses) -->
    @if (Model != null && Model.Any())
    {
        <div class="mt-4 p-4 bg-light rounded-4 border">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h6 class="mb-2 fw-bold">
                        <i class="fas fa-lightbulb text-warning me-2"></i>M·∫πo h·ªçc t·∫≠p
                    </h6>
                    <p class="text-muted small mb-0">
                        Theo d√µi l·ªãch h·ªçc, ho√†n th√†nh b√†i t·∫≠p ƒë√∫ng h·∫°n v√† t∆∞∆°ng t√°c v·ªõi gi·∫£ng vi√™n ƒë·ªÉ ƒë·∫°t k·∫øt qu·∫£ t·ªët nh·∫•t!
                    </p>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <a asp-action="Index" class="btn btn-outline-primary rounded-pill px-4">
                        <i class="fas fa-plus me-2"></i>Th√™m m√¥n h·ªçc
                    </a>
                </div>
            </div>
        </div>
    }
</div>

<style>
    /* Hero Gradient */
    .hero-mycourses {
        background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 60%, #f59e0b 120%);
        box-shadow: 0 1rem 3rem rgba(0,0,0,.15);
    }

    /* Stat Cards */
    .stat-card {
        transition: all .2s ease;
        border-left: 4px solid transparent !important;
    }

        .stat-card.card-primary {
            border-left-color: #4f46e5 !important;
            background: linear-gradient(135deg, rgba(79, 70, 229, .05), white);
        }

        .stat-card.card-success {
            border-left-color: #22c55e !important;
            background: linear-gradient(135deg, rgba(34, 197, 94, .05), white);
        }

        .stat-card.card-info {
            border-left-color: #f59e0b !important;
            background: linear-gradient(135deg, rgba(245, 158, 11, .05), white);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 1rem 2rem rgba(0,0,0,.1) !important;
        }

    .icon-circle {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        background: linear-gradient(135deg, #4f46e5, #06b6d4);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2rem;
    }

    .card-success .icon-circle {
        background: linear-gradient(135deg, #22c55e, #10b981);
    }

    .card-info .icon-circle {
        background: linear-gradient(135deg, #f59e0b, #eab308);
    }

    /* Modern Table */
    .modern-table thead th {
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.5px;
        color: #64748b;
        border-bottom: 2px solid #e2e8f0;
        padding: 1rem;
    }

    .modern-table tbody td {
        padding: 1rem;
        vertical-align: middle;
        border-bottom: 1px solid #f1f5f9;
    }

    .modern-table .course-row {
        transition: all .15s ease;
    }

        .modern-table .course-row:hover {
            background: linear-gradient(to right, rgba(79, 70, 229, .03), transparent);
            transform: scale(1.005);
        }

    /* Card Header Gradient */
    .card-header.bg-gradient {
        background: linear-gradient(to bottom, #f8f9fa, white) !important;
    }

    /* Nav Pills */
    .nav-pills .nav-link.active {
        background: linear-gradient(135deg, #8b5cf6, #ec4899);
    }

    .nav-pills .nav-link {
        transition: all .15s ease;
    }

        .nav-pills .nav-link:hover:not(.active) {
            background: rgba(139, 92, 246, .1);
        }

    /* Badge Animations */
    .badge {
        transition: all .15s ease;
    }

    /* Smooth Scroll */
    html {
        scroll-behavior: smooth;
    }

    /* Button Hover */
    .btn-danger.rounded-pill:hover {
        transform: scale(1.05);
        box-shadow: 0 .25rem .5rem rgba(220, 38, 38, .3);
    }

    /* Responsive Table */
    @@media (max-width: 768px) {
        .modern-table {
            font-size: 0.875rem;
        }

            .modern-table thead th,
            .modern-table tbody td {
                padding: 0.75rem 0.5rem;
            }
    }
</style>
