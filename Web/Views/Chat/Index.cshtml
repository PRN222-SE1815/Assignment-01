@model Web.ViewModels.ChatRoomListVm
@using System.Security.Claims
@{
    ViewBag.Title = "Chat Rooms";
    var userRole = User.FindFirst(ClaimTypes.Role)?.Value ?? "";
    Layout = userRole == "TEACHER" ? "~/Views/Teacher/_LayoutTeacher.cshtml" : "~/Views/Student/_LayoutStudent.cshtml";
}

<section class="chat-rooms-page">
    <div class="chat-container">
        <div class="chat-header">
            <div class="chat-header-content">
                <h1 class="chat-title">
                    <i class="fas fa-comments"></i>
                    My Chat Rooms
                </h1>
                <p class="chat-subtitle">Connect with your classmates and teachers</p>
            </div>
            <div class="chat-header-actions">
                <button type="button" class="btn-create-chat" id="btnOpenCreateModal">
                    <i class="fas fa-plus"></i>
                    <span>New Chat</span>
                </button>
            </div>
        </div>

        @if (TempData["Error"] != null)
        {
            <div class="alert alert-error">
                <i class="fas fa-exclamation-circle"></i>
                @TempData["Error"]
            </div>
        }

        <div class="rooms-list">
            @if (Model.Rooms.Count == 0)
            {
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <h3>No Chat Rooms Yet</h3>
                    <p>You'll see chat rooms here once you're enrolled in courses or classes.</p>
                    <button type="button" class="btn-create-first" id="btnCreateFirst">
                        <i class="fas fa-plus"></i>
                        Start a New Conversation
                    </button>
                </div>
            }
            else
            {
                @foreach (var room in Model.Rooms)
                {
                    <a asp-action="Room" asp-route-id="@room.RoomId" class="room-card">
                        <div class="room-icon @room.RoomType.ToLower()">
                            @if (room.RoomType == "CLASS")
                            {
                                <i class="fas fa-chalkboard"></i>
                            }
                            else if (room.RoomType == "COURSE")
                            {
                                <i class="fas fa-book"></i>
                            }
                            else if (room.RoomType == "DM")
                            {
                                <i class="fas fa-user"></i>
                            }
                            else
                            {
                                <i class="fas fa-users"></i>
                            }
                        </div>
                        <div class="room-info">
                            <h3 class="room-name">@room.RoomName</h3>
                            <span class="room-type-badge @room.RoomType.ToLower()">@room.RoomType</span>
                        </div>
                        <div class="room-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </a>
                }
            }
        </div>
    </div>
</section>

<!-- Create Chat Modal -->
<div class="modal-overlay" id="createChatModal">
    <div class="modal-content create-chat-modal">
        <div class="modal-header">
            <h3><i class="fas fa-plus-circle"></i> Create New Chat</h3>
            <button type="button" class="modal-close" id="btnCloseModal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <!-- Chat Type Tabs -->
            <div class="chat-type-tabs">
                <button type="button" class="tab-btn active" data-tab="dm">
                    <i class="fas fa-user"></i>
                    Direct Message
                </button>
                <button type="button" class="tab-btn" data-tab="group">
                    <i class="fas fa-users"></i>
                    Group Chat
                </button>
            </div>

            <!-- DM Tab Content -->
            <div class="tab-content active" id="dmTabContent">
                <div class="form-group">
                    <label for="dmUserSearch">Search for a user</label>
                    <div class="search-input-wrapper">
                        <i class="fas fa-search"></i>
                        <input type="text" id="dmUserSearch" class="form-input" placeholder="Type a name or email...">
                    </div>
                </div>
                <div class="users-list" id="dmUsersList">
                    <div class="users-placeholder">
                        <i class="fas fa-search"></i>
                        <p>Search for users to start a conversation</p>
                    </div>
                </div>
            </div>

            <!-- Group Tab Content -->
            <div class="tab-content" id="groupTabContent">
                <div class="form-group">
                    <label for="groupName">Group Name <span class="required">*</span></label>
                    <input type="text" id="groupName" class="form-input" placeholder="Enter group name..." maxlength="100">
                </div>
                <div class="form-group">
                    <label for="groupUserSearch">Add Members</label>
                    <div class="search-input-wrapper">
                        <i class="fas fa-search"></i>
                        <input type="text" id="groupUserSearch" class="form-input" placeholder="Search users to add...">
                    </div>
                </div>
                <div class="selected-members" id="selectedMembers">
                    <!-- Selected members will be added here -->
                </div>
                <div class="users-list" id="groupUsersList">
                    <div class="users-placeholder">
                        <i class="fas fa-user-plus"></i>
                        <p>Search for users to add to your group</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="btnCancelCreate">Cancel</button>
            <button type="button" class="btn btn-primary" id="btnConfirmCreate" disabled>
                <i class="fas fa-paper-plane"></i>
                Create Chat
            </button>
        </div>
    </div>
</div>

@Html.AntiForgeryToken()

@section Styles {
    <link rel="stylesheet" href="~/css/Chat/Index.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
}

@section Scripts {
    <script src="~/js/Chat/index.js" asp-append-version="true"></script>
}
