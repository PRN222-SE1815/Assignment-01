@model List<BusinessLogic.DTOs.Responses.GradeResponse>
@using Microsoft.AspNetCore.Mvc.Rendering

@{
    ViewData["Title"] = "My Grades";
    Layout = "~/Views/Shared/_LayoutStudent.cshtml";

    var courses = ViewBag.Courses as IEnumerable<SelectListItem> ?? Enumerable.Empty<SelectListItem>();
    int? selectedCourseId = ViewBag.SelectedCourseId as int?;
}

<div class="container py-4">
<div class="d-flex flex-wrap align-items-start justify-content-between gap-2 mb-3">
    <h2 class="mb-0 fw-bold">My Grades</h2>
    <a asp-controller="Student" asp-action="Index" class="btn btn-light shadow-sm">
        Back
    </a>
    
</div>

    
    <div class="card shadow-sm border-0 mb-3">
        <div class="card-body p-3">
            <form asp-controller="Grades" asp-action="MyGrades" method="get" id="courseForm" class="row g-2">
                <div class="col-12 col-md-6">
                    <label class="form-label small text-muted mb-1">Course</label>
                    <select name="courseId" class="form-select" id="courseSelect">
                        <option value="">All courses</option>
                        @foreach (var c in courses)
                        {
                            var isSelected = (selectedCourseId.HasValue && c.Value == selectedCourseId.Value.ToString());
                            <option value="@c.Value" selected="@(isSelected ? "selected" : null)">@c.Text</option>
                        }
                    </select>
                </div>
            </form>
        </div>
    </div>

    <!-- Table -->
    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th class="ps-3">Course</th>
                            <th class="text-center">Assignment</th>
                            <th class="text-center">Midterm</th>
                            <th class="text-center">Final</th>
                            <th class="text-center">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model == null || !Model.Any())
                        {
                            <tr>
                                <td colspan="5" class="text-center text-muted py-5">
                                    No grades found.
                                </td>
                            </tr>
                        }
                        else
                        {
                            foreach (var g in Model)
                            {
                                <tr>
                                    <td class="ps-3 fw-semibold">@g.CourseName</td>
                                    <td class="text-center">@DisplayScore(g.Assignment)</td>
                                    <td class="text-center">@DisplayScore(g.Midterm)</td>
                                    <td class="text-center">@DisplayScore(g.Final)</td>
                                    <td class="text-center fw-bold">@DisplayScore(g.Total)</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@functions{
    string DisplayScore(decimal? v) => v.HasValue ? v.Value.ToString("0.##") : "—";
}

@section Scripts {
    <script>
        (function () {
            const sel = document.getElementById('courseSelect');
            const form = document.getElementById('courseForm');
            if (sel && form) {
                sel.addEventListener('change', function () {
                    form.submit();
                });
            }
        })();
    </script>
}
